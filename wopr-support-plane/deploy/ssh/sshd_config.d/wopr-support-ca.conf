# WOPR Support Plane - Beacon-side SSH CA Trust Configuration
# Deploy to: /etc/ssh/sshd_config.d/wopr-support-ca.conf
# Requires: CA public key at /etc/ssh/wopr-support-ca.pub

# Trust certificates signed by the WOPR Support CA
TrustedUserCAKeys /etc/ssh/wopr-support-ca.pub

# Map principals to authorized users
AuthorizedPrincipalsFile /etc/ssh/auth_principals/%u

# Diagnostic tier: restricted to read-only commands
Match User wopr-diag
    ForceCommand /usr/local/bin/wopr-diag-shell
    AllowTcpForwarding no
    AllowAgentForwarding no
    X11Forwarding no
    PermitTTY no

# Remediation tier: restricted to approved remediation commands
Match User wopr-remediate
    ForceCommand /usr/local/bin/wopr-remediate-shell
    AllowTcpForwarding no
    AllowAgentForwarding no
    X11Forwarding no
    PermitTTY yes

# Breakglass tier: full access but no forwarding (security)
Match User wopr-breakglass
    AllowTcpForwarding no
    AllowAgentForwarding no
    X11Forwarding no
    PermitTTY yes
