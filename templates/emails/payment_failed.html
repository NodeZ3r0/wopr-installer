<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Failed - Action Required</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            background-color: #0a0a0a;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
    </style>
</head>
<body>
    <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background-color: #0a0a0a;">
        <tr>
            <td align="center" style="padding: 20px 10px;">
                <table role="presentation" cellspacing="0" cellpadding="0" border="0" style="max-width: 600px; width: 100%; background-color: #111111; border-radius: 12px; overflow: hidden;">

                    <!-- Header -->
                    <tr>
                        <td style="background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%); padding: 40px 30px; text-align: center; border-bottom: 2px solid #ff6b6b;">
                            <div style="font-size: 32px; font-weight: 700; color: #00ff41; letter-spacing: 4px;">WOPR</div>
                        </td>
                    </tr>

                    <!-- Content -->
                    <tr>
                        <td style="padding: 40px 30px;">

                            <!-- Alert Badge -->
                            <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                <tr>
                                    <td align="center">
                                        <span style="display: inline-block; background: rgba(255, 107, 107, 0.1); border: 1px solid #ff6b6b; color: #ff6b6b; padding: 8px 20px; border-radius: 20px; font-size: 14px; font-weight: 600;">Payment Failed</span>
                                    </td>
                                </tr>
                            </table>

                            <h1 style="color: #ffffff; font-size: 28px; font-weight: 600; margin: 20px 0; text-align: center;">We couldn't process your payment</h1>

                            <p style="color: #cccccc; font-size: 16px; line-height: 1.6; text-align: center;">
                                Hi {{ name }}, we tried to charge your payment method for your WOPR subscription but it was declined. Please update your payment information to avoid service interruption.
                            </p>

                            <!-- Alert Box -->
                            <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="margin: 30px 0;">
                                <tr>
                                    <td style="background: rgba(255, 107, 107, 0.1); border: 2px solid #ff6b6b; border-radius: 8px; padding: 25px; text-align: center;">
                                        <p style="color: #ff6b6b; font-size: 14px; font-weight: 600; margin: 0 0 10px 0;">ACTION REQUIRED</p>
                                        <p style="color: #ffffff; font-size: 16px; margin: 0;">
                                            {% if grace_days_remaining > 0 %}
                                            Your service will be suspended in <strong>{{ grace_days_remaining }} days</strong> if payment is not received.
                                            {% else %}
                                            Your service has been suspended. Update payment to restore access.
                                            {% endif %}
                                        </p>
                                    </td>
                                </tr>
                            </table>

                            <!-- Payment Details -->
                            <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background: #1a1a1a; border: 1px solid #333333; border-radius: 8px; margin: 25px 0;">
                                <tr>
                                    <td style="padding: 25px;">
                                        <h3 style="color: #ffffff; font-size: 16px; margin: 0 0 15px 0;">Payment Details</h3>

                                        <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                            <tr>
                                                <td style="padding: 10px 0; border-bottom: 1px solid #2a2a2a;">
                                                    <span style="color: #888888; font-size: 14px;">Amount</span>
                                                </td>
                                                <td style="padding: 10px 0; border-bottom: 1px solid #2a2a2a; text-align: right;">
                                                    <span style="color: #ffffff; font-size: 14px; font-weight: 600;">${{ amount }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 10px 0; border-bottom: 1px solid #2a2a2a;">
                                                    <span style="color: #888888; font-size: 14px;">Billing Period</span>
                                                </td>
                                                <td style="padding: 10px 0; border-bottom: 1px solid #2a2a2a; text-align: right;">
                                                    <span style="color: #ffffff; font-size: 14px; font-weight: 600;">{{ billing_period }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 10px 0; border-bottom: 1px solid #2a2a2a;">
                                                    <span style="color: #888888; font-size: 14px;">Payment Method</span>
                                                </td>
                                                <td style="padding: 10px 0; border-bottom: 1px solid #2a2a2a; text-align: right;">
                                                    <span style="color: #ffffff; font-size: 14px; font-weight: 600;">{{ card_brand }} ending in {{ card_last4 }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 10px 0;">
                                                    <span style="color: #888888; font-size: 14px;">Failure Reason</span>
                                                </td>
                                                <td style="padding: 10px 0; text-align: right;">
                                                    <span style="color: #ff6b6b; font-size: 14px; font-weight: 600;">{{ failure_reason }}</span>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>

                            <!-- Common reasons -->
                            <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background: #1a1a1a; border: 1px solid #333333; border-radius: 8px; margin: 25px 0;">
                                <tr>
                                    <td style="padding: 25px;">
                                        <h3 style="color: #ffffff; font-size: 16px; margin: 0 0 15px 0;">Common reasons for payment failure:</h3>

                                        <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                            <tr>
                                                <td style="padding: 8px 0;">
                                                    <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                                        <tr>
                                                            <td width="24" valign="top" style="color: #888888; font-size: 14px;">1.</td>
                                                            <td style="color: #cccccc; font-size: 14px;">Card expired or about to expire</td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 8px 0;">
                                                    <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                                        <tr>
                                                            <td width="24" valign="top" style="color: #888888; font-size: 14px;">2.</td>
                                                            <td style="color: #cccccc; font-size: 14px;">Insufficient funds</td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 8px 0;">
                                                    <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                                        <tr>
                                                            <td width="24" valign="top" style="color: #888888; font-size: 14px;">3.</td>
                                                            <td style="color: #cccccc; font-size: 14px;">Card issuer declined the transaction</td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 8px 0;">
                                                    <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                                        <tr>
                                                            <td width="24" valign="top" style="color: #888888; font-size: 14px;">4.</td>
                                                            <td style="color: #cccccc; font-size: 14px;">International transaction blocked</td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>

                            <!-- CTA Button -->
                            <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                <tr>
                                    <td align="center" style="padding: 20px 0;">
                                        <a href="https://{{ beacon_name }}.wopr.systems/billing/update-payment" style="display: inline-block; background: #00ff41; color: #000000; text-decoration: none; padding: 16px 40px; border-radius: 8px; font-size: 16px; font-weight: 600;">Update Payment Method</a>
                                    </td>
                                </tr>
                            </table>

                            <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                <tr>
                                    <td align="center" style="padding: 10px 0;">
                                        <a href="https://{{ beacon_name }}.wopr.systems/billing/retry" style="color: #00ff41; text-decoration: none; font-size: 14px;">Or retry with current payment method</a>
                                    </td>
                                </tr>
                            </table>

                            <!-- Timeline -->
                            <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background: #1a1a1a; border: 1px solid #333333; border-radius: 8px; margin: 30px 0;">
                                <tr>
                                    <td style="padding: 25px;">
                                        <h3 style="color: #ffffff; font-size: 16px; margin: 0 0 15px 0;">What happens next?</h3>

                                        <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                            <tr>
                                                <td style="padding: 10px 0; border-bottom: 1px solid #2a2a2a;">
                                                    <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                                        <tr>
                                                            <td width="80" style="color: #888888; font-size: 13px;">Day 1-3</td>
                                                            <td style="color: #cccccc; font-size: 14px;">We'll retry the payment automatically</td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 10px 0; border-bottom: 1px solid #2a2a2a;">
                                                    <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                                        <tr>
                                                            <td width="80" style="color: #888888; font-size: 13px;">Day 7</td>
                                                            <td style="color: #ffc107; font-size: 14px;">Service will be suspended</td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 10px 0;">
                                                    <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
                                                        <tr>
                                                            <td width="80" style="color: #888888; font-size: 13px;">Day 14</td>
                                                            <td style="color: #ff6b6b; font-size: 14px;">Data will be permanently deleted</td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>

                            <p style="color: #888888; font-size: 13px; text-align: center; margin: 20px 0 0 0;">
                                Need help? Contact us at <a href="mailto:billing@wopr.systems" style="color: #00ff41; text-decoration: none;">billing@wopr.systems</a>
                            </p>

                        </td>
                    </tr>

                    <!-- Footer -->
                    <tr>
                        <td style="background: #0a0a0a; padding: 30px; text-align: center; border-top: 1px solid #333333;">
                            <p style="color: #666666; font-size: 12px; margin: 0 0 10px 0;">
                                WOPR Systems - Your Personal Cloud Infrastructure
                            </p>
                            <p style="color: #444444; font-size: 11px; margin: 20px 0 0 0;">
                                This is a transactional email regarding your account.
                            </p>
                        </td>
                    </tr>

                </table>
            </td>
        </tr>
    </table>
</body>
</html>
